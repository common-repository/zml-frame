!function($){$(function(){$(".action-page-form").pageForm(),$(".action-page-tabs").pageTabs(),$(".action-area-tabs").areaTabs(),$(".action-body-tabs").bodyTabs(),$(".action-area-active").areaActive()}),$.fn.pageForm=function(){function a(){if("localhost"!==window.location.hostname){var a=!1,b=$(".adsbygoogle");$.each(b,function(){("none"==$(this).css("display")||0==$(this).css("height"))&&(a=!0)}),(0===b.length||a)&&zmlAlert({text:"您的浏览器启用了Adblock插件，这可能会导致广告设置部分显示错误，请在本站或本页面上关闭Adblock插件。",icon:"warning",confirm:!0,cancel:!1})}}this.each(function(){function r(){$(".wp-editor-area").each(function(){var a=$(this).attr("id"),b=tinyMCE.get(a);b&&$("#"+a).val(b.getContent())});var a=c.serialize()+"&action="+f.val();$.ajax({type:"POST",dataType:"json",url:ajaxurl,data:a,beforeSend:function(){e.html(n+"正在保存中……")},success:function(){b.off("beforeunload"),e.html(q+"保存成功！"),setTimeout(function(){e.html(" ")},"5000")},error:function(){e.html(p+"发生错误，保存失败！")}})}function s(){var a=c.serialize()+"&action="+g.val();zmlAlert({text:"确认将所有选项恢复为默认值吗？",icon:"warning",button:!0}).then(function(c){c&&$.ajax({type:"POST",dataType:"json",url:ajaxurl,data:a,beforeSend:function(){e.html(n+"正在重置中……")},success:function(){b.unbind("beforeunload"),e.html(q+"重置成功，请等待页面刷新！"),zmlAlert({text:"所有选项已恢复为默认值！",icon:"success",button:!1}),setTimeout(function(){window.location.reload()},"2000")},error:function(){e.html(p+"发生错误，重置失败！")}})})}function t(){var a=c.serialize()+"&action="+h.val();$.ajax({type:"POST",dataType:"json",url:ajaxurl,data:a,beforeSend:function(){e.html(n+"正在读取选项设置……")},success:function(a){var c=document.createElement("input");c.value=a.value,document.body.appendChild(c),c.select(),document.execCommand("Copy"),c.style.display="none",b.unbind("beforeunload"),e.html(q+"复制成功，请妥善保存设置内容！"),zmlAlert({text:"选项设置复制成功！",icon:"success",confirm:!0,cancel:!1}),setTimeout(function(){e.html(" ")},"5000")},error:function(){e.html(p+"发生错误，复制失败！")}})}function u(){var a=c.serialize()+"&action="+i.val();$.ajax({type:"POST",dataType:"json",url:ajaxurl,data:a,beforeSend:function(){e.html(n+"正在生成备份文件……")},success:function(a){var d,c=document.createElement("a");c.setAttribute("href","data:text/plain;charset=utf-8,"+a.value),c.setAttribute("download",a.name+".dat"),document.createEvent?(d=document.createEvent("MouseEvents"),d.initEvent("click",!0,!0),c.dispatchEvent(d)):c.click(),b.unbind("beforeunload"),e.html(q+"下载成功，请妥善保存备份文件！"),zmlAlert({text:"选项设置下载成功！",icon:"success",confirm:!0,cancel:!1}),setTimeout(function(){e.html(" ")},"5000")},error:function(){e.html(p+"发生错误，下载失败！")}})}function v(a){var b=a.files[0],c=new FileReader;c.readAsText(b,"utf-8"),c.onload=function(a){j.val(a.target.result)}}function w(){var a=j.val(),d=c.serialize()+"&action="+m.val();return""===$.trim(a)||null===a||"undefined"===a?(zmlAlert({text:'请先上传文件或粘贴内容到"设置内容"中！',icon:"error",confirm:!0,cancel:!1}),!1):(zmlAlert({text:"确认将选项恢复为上述设置？",icon:"warning",button:!0}).then(function(a){a&&$.ajax({type:"POST",dataType:"json",url:ajaxurl,data:d,beforeSend:function(){e.html(n+"恢复设置中……")},success:function(a){"success"===a.state?(b.unbind("beforeunload"),e.html(q+"恢复成功，请等待页面刷新！"),zmlAlert({text:"选项设置恢复成功！",icon:"success",button:!1}),setTimeout(function(){window.location.reload()},"2000")):(e.html(p+"数据验证失败，无法恢复！"),zmlAlert({text:"数据验证失败，无法恢复！",icon:"error",button:!1}))},error:function(){e.html(p+"发生错误，恢复失败！")}})}),void 0)}function x(){c.on("change",function(){e.html(o+"注意，选项发生改动，但尚未保存。"),b.on("beforeunload",function(){return confirm("您修改的设置尚未保存，确定离开此页面吗？")})}),f.on("click",function(a){r(),a.preventDefault()}),g.on("click",function(a){s(),a.preventDefault()}),h.on("click",function(a){t(),a.preventDefault()}),i.on("click",function(a){u(),a.preventDefault()}),k.on("click",function(a){l.click(),a.preventDefault()}),l.on("change",function(){v(this)}),m.on("click",function(a){w(),a.preventDefault()})}var b=$(window),c=$(this),d=c.prop("id").replace("-form",""),e=$("#"+d+"-status"),f=$("#"+d+"-save"),g=$("#"+d+"-reset"),h=$("#"+d+"-backup-copy"),i=$("#"+d+"-backup-down"),j=$("#"+d+"-restore-read"),k=$("#"+d+"-restore-select"),l=$("#"+d+"-restore-upload"),m=$("#"+d+"-restore-button"),n='<svg class="svg-icon working" aria-hidden="true"><use xlink:href="#icon-frame-working"></use></svg>',o='<svg class="svg-icon alert" aria-hidden="true"><use xlink:href="#icon-frame-alert"></use></svg>',p='<svg class="svg-icon error" aria-hidden="true"><use xlink:href="#icon-frame-error"></use></svg>',q='<svg class="svg-icon success" aria-hidden="true"><use xlink:href="#icon-frame-success"></use></svg>';x(),a()})},$.fn.pageTabs=function(){this.each(function(){function showTab(){var data_show=node_show.data("tabs-link"),text_ourl=window.location.href.toString(),rule_nurl=eval("/(tab=)([^&]*)/gi"),text_nurl=text_ourl.replace(rule_nurl,"tab="+data_show);data_show&&(window.history.pushState("","",text_nurl),node_tabs.find(".tabs-page-menu").removeClass("current"),node_tabs.find('.tabs-page-menu[data-tabs-menu="'+node_show.data("tabs-menu")+'"]').addClass("current"),node_tabs.find(".tabs-page-link").removeClass("current"),node_tabs.find('.tabs-page-link[data-tabs-link="'+node_show.data("tabs-link")+'"]').addClass("current"),node_tabs.find(".tabs-page-main").css("display","none"),node_tabs.find(".tabs-page-main").removeClass("current"),node_tabs.find('.tabs-page-main[data-tabs-main="'+node_show.data("tabs-link")+'"]').fadeIn(400,function(){$(this).addClass("current")}))}function renewTab(){node_tabs.find('.tabs-page-link[data-tabs-link="'+node_show.data("tabs-link")+'"]').hasClass("renew")&&window.location.reload()}var node_tabs=$(this),node_link=node_tabs.find(".tabs-page-link"),node_show=node_link.first(),data_show=node_show.data("tabs-link"),text_curl=window.location.href.toString(),rule_curl=new RegExp("(^|&)tab=([^&]*)(&|$)"),data_curl=window.location.search.substring(1).match(rule_curl);data_curl?node_show=$(".tabs-page-link[data-tabs-link="+data_curl[2]+"]"):(text_curl=text_curl+"&tab="+data_show,window.history.pushState("","",text_curl)),showTab(),node_link.on("click",function(){node_show=$(this),showTab(),renewTab()})})},$.fn.areaTabs=function(){function h(){c.find(".tabs-area-link").removeClass("current"),c.find('.tabs-area-link[data-tabs-link="'+g.data("tabs-link")+'"]').addClass("current"),c.find(".tabs-area-main").css("display","none"),c.find(".tabs-area-main").removeClass("current"),c.find('.tabs-area-main[data-tabs-main="'+g.data("tabs-link")+'"]').fadeIn(400,function(){$(this).addClass("current")})}var c,d,e,f,g,a=$(".area-tabs").length+1,b="area-tabs-"+a;this.first().before("<div class='area-tabs' id='"+b+"'><div class='content-aside'><ul class='content-tabs'></ul></div><div class='content-main'></div></div>"),c=$("#"+b),d=c.find(".content-tabs"),e=c.find(".content-main"),this.each(function(){var a=$(this),b=a.data("tabs-item"),c=a.data("tabs-name"),f=a.clone().html(),g=e.find('.tabs-area-main[data-tabs-main="'+b+'"]');g.length>0?g.append(f):(d.append('<li class="tabs-area-link" data-tabs-link="'+b+'">'+c+"</li>"),e.append('<div class="tabs-area-main" data-tabs-main="'+b+'">'+f+"</div>")),a.remove()}),f=c.find(".tabs-area-link"),g=f.first(),h(),f.on("click",function(){g=$(this),h()})},$.fn.bodyTabs=function(){this.each(function(){function d(){a.find(".tabs-body-link").removeClass("current"),a.find('.tabs-body-link[data-tabs-link="'+c.data("tabs-link")+'"]').addClass("current"),a.find(".tabs-body-main").css("display","none"),a.find(".tabs-body-main").removeClass("current"),a.find('.tabs-body-main[data-tabs-main="'+c.data("tabs-link")+'"]').fadeIn(0,function(){$(this).addClass("current")})}var a=$(this),b=a.find(".tabs-body-link"),c=b.first();d(),b.on("click",function(){c=$(this),d()})})},$.fn.areaActive=function(){this.each(function(){function e(){a.prop("checked")?(d.fadeIn(400,function(){$(this).addClass("active")}),c.fadeOut(1)):(c.fadeIn(400),d.fadeOut(1,function(){$(this).removeClass("active")}))}var a=$(this),b=a.prop("id"),c=$("#"+b+"-margin"),d=$("#"+b+"-active");e(),a.on("click",function(){e()})})}}(jQuery);