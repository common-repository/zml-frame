!function(a){a(function(){a(".action-view-score").viewScore(),a(".action-view-select").viewSelect(),a(".action-input-tags").inputTags(),a(".action-select-tags").selectTags(),a(".action-form-hidden").formHidden(),a(".action-file-upload").fileUpload(),a(".action-color-picker").wpColorPicker()}),a.fn.viewScore=function(){this.each(function(){function h(){var a=b.val(),e=a.replace(/[\u007F-\u00FE]/g," ").replace(/[^!-~\d\s]+/gi," ").match(/[\u00ff-\uffff]|\S+/g),h=a.replace(/[\u007F-\u00FE]/g," ").replace(/[!-~\d\s]+/gi,"").match(/[\u00ff-\uffff]|\S+/g),i=e?e.length:0,j=h?h.length:0,k=i+j,l="字符："+k+" - ",m="#ffffff";0==k?(size_score=0,l+="无输入",m="#2271b1"):c>k?(size_score=100*k/d,l+="太短了",m="#ffa700"):k>d?(size_score=100*d/k,l+="太长了",m="#dd3811"):k==d?(size_score=100*k/d,l+="最佳",m="#0cc34b"):(size_score=100*k/d,l+="范围内",m="#0cc34b"),f.text(l),f.css("color",m),g.css("width",size_score+"%"),g.css("background",m)}var b=a(this),c=b.data("min"),d=b.data("max"),e=b.parent().parent().parent(),f=e.find(".score-tips"),g=e.find(".score-fill");h(),b.on("keyup",function(){h()})})},a.fn.viewSelect=function(){this.each(function(){function e(){d.prop("src",d.data("path")+b.val()+d.data("ext"))}var b=a(this),c=b.prop("id"),d=a("#"+c+"-image");e(),b.on("change",function(){e()})})},a.fn.inputTags=function(){function b(b){var b=b.replace(/<\/?[^>]*>/g,"");return b=b.replace(/</g,""),b=b.replace(/>/g,""),b=a.trim(b)}function c(c,d){var e=a(c);for(i=0;i<d.length;i++)""!=a.trim(d[i])&&e.append('<div class="tag-item"><span class="tag-text">'+b(d[i])+'</span><span class="tag-edit edit" title="编辑"></span><span class="tag-edit remove" title="移除"></span></div>')}function d(b,c){var d=a(b);"toedit"==c?(text_edit="保存更改",text_remove="取消更改"):(text_edit="编辑",text_remove="移除"),d.children(".tag-edit.edit").prop("title",text_edit),d.children(".tag-edit.remove").prop("title",text_remove)}this.each(function(){function m(){var a=e.val().split(",");g.empty(),c(g,a),o(),p()}function n(c,d){var f=e.val(),g="";for(","!=f.charAt(f.length-1)&&(f+=","),f=f.split(","),"add"!=c?f.splice(c,1,d):f.splice(f.length-1,1,d),i=0;i<f.length;i++)""!=a.trim(f[i])&&(g+=a.trim(f[i])+",");e.val(b(g))}function o(){var a=g.children(".tag-item").length;for(i=0;a>i;i++)g.children(".tag-item:eq("+i+")").attr("index",i)}function p(){e.on("change",function(){m()}),h.on("keydown",function(b){return 13==b.keyCode?(a(this).next().click(),!1):void 0}),j.on("click",function(){var a=h.val();a=a.replace(/，/g,","),a=a.split(","),c(g,a),a=a.join(","),n("add",a),h.val(""),o(),p()}),k.on("click",function(){l.open()}),l.on("select",function(){var a=l.state().get("selection").first().toJSON().url,b=h.val();b=b.replace(new RegExp(a,"g"),""),h.val(b+a)}),a(".tag-edit",g).off("click"),a(".tag-edit",g).on("click",function(){var b=a(this);b.parent().hasClass("editing")?b.hasClass("edit")?r(b.parent(),"finish"):b.hasClass("remove")&&r(b.parent(),"cancel"):b.hasClass("edit")?q(b.parent()):b.hasClass("remove")&&s(b.parent())})}function q(b){var c=a(b),e=a(".tag-editing",c.parent());e.length>0&&r(e.parent().parent(),"cancel"),c.addClass("editing"),d(c,"toedit"),html_text=c.children(".tag-text").html(),c.children(".tag-text").attr("index",html_text),show_list=c.parent().hasClass("list-line"),html_text=html_text.length>128||show_list?'<span class="tag-editing"><textarea class="tag-editor" style="width:'+(parseInt(c.css("width"))-50)+'px">'+html_text+"</textarea></span>":'<span class="tag-editing"><input class="tag-editor" type="text" value="'+html_text+'" style="width:'+(parseInt(c.css("width"))-55)+'px"/></span>',c.children(".tag-text").html(html_text),a(".tag-editor",c).on("keydown",function(b){return 13==b.keyCode?(a(this).parent().parent().next().click(),!1):void 0}),e.children("input").focus()}function r(c,e){var f=a(c),g=f.attr("index"),h=a(".tag-editing",f),i="finish"==e?h.children(".tag-editor").val():f.children(".tag-text").attr("index");f.removeClass("editing").removeAttr("style"),d(c,"unedit"),n(g,i),f.children(".tag-text").html(b(i)),h.remove()}function s(b){var c=a(b),d=c.attr("index");c.remove(),n(d,"")}var e=a(this),f=e.prop("id"),g=a("#"+f+"-front"),h=a("#"+f+"-input"),j=a("#"+f+"-submit"),k=a("#"+f+"-upload"),l=wp.media({title:"上传文件",button:{text:"确定"},multiple:!1});e.hide(),m(),p()})},a.fn.selectTags=function(){function b(b){var c=b.replace(/<\/?[^>]*>/g,"");return c=c.replace(/</g,""),c=c.replace(/>/g,""),c=a.trim(c)}function c(c,d){if(a(c).focus(),""!=a.trim(d)){var e,f,g,h,i,j='<span contenteditable="false">'+b(d)+"</span>";if(window.getSelection){if(e=window.getSelection(),e.getRangeAt&&e.rangeCount){for(f=document.createElement("div"),g=document.createDocumentFragment(),range=e.getRangeAt(0),f.innerHTML=j;h=f.firstChild;)i=g.appendChild(h);range.deleteContents(),range.insertNode(g),i&&(range=range.cloneRange(),range.setStartAfter(i),range.collapse(!0),e.removeAllRanges(),e.addRange(range))}}else document.selection&&"Control"!=document.selection.type&&document.selection.createRange().pasteHTML(j)}}this.each(function(){function i(){var b,a=d.val();for(b=1;b<h.length;b++)a=a.replace(new RegExp(h[b].value,"g"),'<span contenteditable="false">'+h[b].text+"</span>");f.empty(),f.append(a)}function j(){var c,a=f.html();for(c=1;c<h.length;c++)a=a.replace(new RegExp('<span contenteditable="false">'+h[c].text+"</span>","g"),h[c].value);d.val(b(a))}function k(){f.on("blur",function(){j()}),f.on("keydown",function(a){return 13==a.keyCode?!1:void 0}),d.on("change",function(){i()}),g.on("change",function(){var a=g.find("option:selected").text();c(f,a),j(),g.val("")})}var d=a(this),e=d.prop("id"),f=a("#"+e+"-front"),g=a("#"+e+"-input"),h=g.find("option");d.hide(),i(),k()})},a.fn.formHidden=function(){this.each(function(){function e(){b.prop("checked")?d.fadeOut(1,function(){a(this).addClass("hidden")}):d.fadeIn(400,function(){a(this).removeClass("hidden")})}var b=a(this),c=b.prop("id"),d=a("#"+c+"-form");e(),b.on("click",function(){e()})})},a.fn.fileUpload=function(){this.each(function(){function h(){f.prop("src",b.val())}var b=a(this),c=b.prop("id"),d=a("#"+c+"-upload"),e=a("#"+c+"-delete"),f=a("#"+c+"-image"),g=wp.media({title:"上传文件",button:{text:"确定"},multiple:!1});h(),b.on("change",function(){h()}),d.on("click",function(){g.open()}),e.on("click",function(){b.val(""),h()}),g.on("select",function(){var a=g.state().get("selection").first().toJSON().url;b.val(a),h()})})}}(jQuery);